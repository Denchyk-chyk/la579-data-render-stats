<!doctype html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <title>–°–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-light">
    <div class="container mt-5">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>–ù–∞—à—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ</h2>
        <div>
          <a href="stats.html" class="btn btn-outline-primary btn-sm me-2"
            >üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a
          >
          <a href="index.html" class="btn btn-outline-secondary btn-sm"
            >‚Üê –ù–∞–∑–∞–¥ –¥–æ —Ñ–æ—Ä–º–∏</a
          >
        </div>
      </div>

      <div id="usersList" class="row g-3"></div>
    </div>

    <script>
      const API_URL = "https://lab7-render-6jxa.onrender.com/api";

      // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ª–æ–≥—É–≤–∞–Ω–Ω—è –ø–æ–¥—ñ–π
      async function logAction(action) {
        try {
          await fetch(`${API_URL}/log`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ action }),
          });
        } catch (e) {
          console.error("–ü–æ–º–∏–ª–∫–∞ –ª–æ–≥—É–≤–∞–Ω–Ω—è:", e);
        }
      }

      async function loadUsers() {
        const container = document.getElementById("usersList");
        try {
          // 1. –õ–û–ì–£–í–ê–ù–ù–Ø: –ü–µ—Ä–µ–≥–ª—è–¥ —Å–ø–∏—Å–∫—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
          logAction("view_users_list");

          const response = await fetch(`${API_URL}/users`);
          const users = await response.json();

          container.innerHTML = users
            .map(
              (user) => `
                    <div class="col-md-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title">${user.name}</h5>
                                <h6 class="card-subtitle mb-2 text-muted">${user.email}</h6>
                                <p class="card-text">–≤—ñ–∫: ${user.age}</p>
                                <p class="card-text text-secondary small">${user.comment || ""}</p>
                            </div>
                        </div>
                    </div>
                `,
            )
            .join("");
        } catch (error) {
          container.innerHTML =
            '<p class="text-danger">–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–∞–Ω—ñ</p>';
        }
      }

      loadUsers();
    </script>
  </body>
</html>
